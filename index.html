<!doctype html>
<html lang="zh-TW">
  <head>
    <!-- æ­¤è™•ç‚º Google ç¶²ç«™é©—è­‰ä»£ç¢¼(å‹¿åˆªé™¤) -->
    <meta
      name="google-site-verification"
      content="Cn0qWqxxtImBwp1SZHdPq7FLVYuWmZ26l8TyBewIIO4"
    />
    <!-- ===== åŸºæœ¬è¨­å®š ===== -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- ===== ç¶²ç«™èº«åˆ†è­˜åˆ¥ (ç¬¦åˆ GSB å®‰å…¨è¦ç¯„) ===== -->
    <meta
      name="description"
      content="DCCSèªçŸ¥å½ˆæ€§è¨“ç·´æ¨¡çµ„æ˜¯ä¸­åŸå¤§å­¸ç‰¹æ®Šæ•™è‚²å­¸ç³»çš„å­¸è¡“ç ”ç©¶å·¥å…·ï¼Œå°ˆç‚ºè½éšœå­¸ç”Ÿè¨­è¨ˆã€‚æ¡ç”¨çœ¼ç›èˆ‡å˜´å·´ä½œç‚ºåˆºæ¿€ç‰©ï¼Œç¬¦åˆè½éšœå­¸ç”Ÿè¦–è¦ºå­¸ç¿’ç‰¹æ€§ã€‚ä¸æ”¶é›†ä»»ä½•å€‹äººè³‡è¨Šï¼Œæ‰€æœ‰è³‡æ–™åƒ…åœ¨ç€è¦½å™¨æœ¬åœ°è™•ç†ã€‚"
    />
    <meta name="author" content="ä¸­åŸå¤§å­¸ç‰¹æ®Šæ•™è‚²å­¸ç³»ç¢©å£«ç­" />
    <meta
      name="keywords"
      content="DCCS, èªçŸ¥å½ˆæ€§, åŸ·è¡ŒåŠŸèƒ½, è½éšœå­¸ç”Ÿ, ç‰¹æ®Šæ•™è‚², å­¸è¡“ç ”ç©¶, èªçŸ¥è¨“ç·´"
    />
    <meta name="classification" content="Education, Academic Research" />
    <meta name="category" content="Education" />
    <meta name="robots" content="index, follow" />

    <!-- ===== å®‰å…¨æ€§è¨­å®š (Content Security Policy) ===== -->
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self'; connect-src 'none'; frame-ancestors 'none'; form-action 'self'; base-uri 'self';"
    />

    <!-- ===== é˜²æ­¢å®‰å…¨æ”»æ“Š ===== -->
    <meta http-equiv="X-Frame-Options" content="DENY" />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="X-XSS-Protection" content="1; mode=block" />

    <!-- ===== Open Graph (ç¤¾ç¾¤åˆ†äº«) ===== -->
    <meta property="og:title" content="DCCSèªçŸ¥å½ˆæ€§è¨“ç·´æ¨¡çµ„ - è½éšœå­¸ç”Ÿå°ˆç”¨" />
    <meta
      property="og:description"
      content="ä¸­åŸå¤§å­¸ç‰¹æ®Šæ•™è‚²å­¸ç³»å­¸è¡“ç ”ç©¶å·¥å…·ï¼Œå°ˆç‚ºè½éšœå­¸ç”Ÿè¨­è¨ˆçš„èªçŸ¥å½ˆæ€§è¨“ç·´ç³»çµ±"
    />
    <meta property="og:type" content="website" />

    <title>
      DCCSèªçŸ¥å½ˆæ€§è¨“ç·´æ¨¡çµ„ - è½éšœå­¸ç”Ÿå°ˆç”¨ | ä¸­åŸå¤§å­¸ç‰¹æ•™ç³»å­¸è¡“ç ”ç©¶å·¥å…·
    </title>
    <style>
      /* =================================================================
           å…¨åŸŸæ¨£å¼è¨­å®š (Global Styles)
           ================================================================= */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Microsoft JhengHei", Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
      }

      /* =================================================================
           éŠæˆ²ä¸»å®¹å™¨ (Main Game Container)
           ================================================================= */
      #gameContainer {
        width: 90vw;
        max-width: 1200px;
        height: 90vh;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        display: flex;
        flex-direction: column;
        position: relative;
        overflow: hidden;
      }

      /* =================================================================
           æ¨™é¡Œå€åŸŸ (Header Area)
           ================================================================= */
      #header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        text-align: center;
        font-size: 24px;
        font-weight: bold;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      /* =================================================================
           ä¸»è¦éŠæˆ²å€åŸŸ (Main Game Area)
           ================================================================= */
      #mainArea {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 40px;
        position: relative;
      }

      /* =================================================================
           ç•«é¢å€å¡Š (Screen Sections)
           - æ‰€æœ‰ç•«é¢é è¨­éš±è—ï¼Œé€é .active é¡åˆ¥é¡¯ç¤º
           ================================================================= */
      .screen {
        display: none;
        width: 100%;
        height: 100%;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
      }

      .screen.active {
        display: flex;
      }

      /* =================================================================
           é¦–é ç•«é¢ (Landing Screen)
           ================================================================= */
      #landingScreen h2 {
        font-size: 32px;
        color: #667eea;
        margin-bottom: 30px;
      }

      #landingScreen p {
        font-size: 18px;
        color: #666;
        margin-bottom: 20px;
        line-height: 1.6;
      }

      /* =================================================================
           è¼¸å…¥æ¬„ä½æ¨£å¼ (Input Field Styles)
           ================================================================= */
      .input-group {
        margin: 30px 0;
      }

      .input-group label {
        display: block;
        font-size: 18px;
        color: #333;
        margin-bottom: 10px;
      }

      .input-group input {
        padding: 15px 20px;
        font-size: 18px;
        border: 2px solid #667eea;
        border-radius: 10px;
        width: 300px;
        text-align: center;
      }

      /* =================================================================
           æŒ‰éˆ•æ¨£å¼ (Button Styles)
           ================================================================= */
      .btn {
        padding: 15px 40px;
        font-size: 18px;
        font-weight: bold;
        color: white;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 50px;
        cursor: pointer;
        transition:
          transform 0.2s,
          box-shadow 0.2s;
        margin: 10px;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn-secondary {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      }

      /* =================================================================
           èªªæ˜ç•«é¢ (Instruction Screen)
           ================================================================= */
      .instruction-box {
        background: #f8f9fa;
        padding: 30px;
        border-radius: 15px;
        max-width: 800px;
        margin: 20px auto;
        text-align: left;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .instruction-box h3 {
        color: #667eea;
        font-size: 24px;
        margin-bottom: 20px;
        text-align: center;
      }

      .instruction-box ul {
        list-style: none;
        padding: 0;
      }

      .instruction-box li {
        padding: 15px;
        margin: 10px 0;
        background: white;
        border-left: 4px solid #667eea;
        border-radius: 5px;
        font-size: 16px;
      }

      .instruction-box .highlight {
        color: #f5576c;
        font-weight: bold;
      }

      /* =================================================================
           è¦–è¦ºæç¤ºå€åŸŸ (Visual Cue Area)
           ================================================================= */
      #visualCue {
        position: absolute;
        top: 20px;
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        padding: 15px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 10px;
      }

      .cue-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 20px;
        border-radius: 10px;
        font-size: 16px;
        font-weight: bold;
      }

      .cue-icon {
        width: 40px;
        height: 40px;
      }

      .cue-active {
        background: #ffd700;
        transform: scale(1.1);
        box-shadow: 0 5px 15px rgba(255, 215, 0, 0.5);
      }

      /* =================================================================
           å¡ç‰‡é¡¯ç¤ºå€åŸŸ (Card Display Area)
           ================================================================= */
      #cardDisplay {
        width: 400px;
        height: 500px;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: relative;
        transition: transform 0.3s;
      }

      #cardDisplay.correct {
        border: 5px solid #4caf50;
        animation: correctPulse 0.5s;
      }

      #cardDisplay.incorrect {
        border: 5px solid #f44336;
        animation: incorrectShake 0.5s;
      }

      @keyframes correctPulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      @keyframes incorrectShake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-10px);
        }
        75% {
          transform: translateX(10px);
        }
      }

      /* å¡ç‰‡èƒŒæ™¯å±¤ (Card Background Layer) */
      #cardBackground {
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 20px;
        z-index: 1;
      }

      /* å¡ç‰‡å‰æ™¯å±¤ (Card Foreground Layer) */
      #cardForeground {
        position: relative;
        z-index: 2;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      #cardForeground svg {
        width: 200px;
        height: 200px;
      }

      /* =================================================================
           åˆ†é¡ç›’å­å€åŸŸ (Sorting Boxes Area)
           ================================================================= */
      #sortingBoxes {
        display: flex;
        gap: 100px;
        margin-top: 50px;
      }

      .sorting-box {
        width: 150px;
        height: 150px;
        border: 4px solid #333;
        border-radius: 15px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition:
          transform 0.2s,
          box-shadow 0.2s;
        background: white;
      }

      .sorting-box:hover {
        transform: scale(1.05);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
      }

      .sorting-box svg {
        width: 80px;
        height: 80px;
        margin-bottom: 10px;
      }

      .sorting-box .label {
        font-size: 16px;
        font-weight: bold;
        color: #333;
      }

      /* å·¦éµç›’å­ (Left Box) */
      .sorting-box.left.active {
        border-color: #2196f3;
        box-shadow: 0 0 20px rgba(33, 150, 243, 0.5);
      }

      /* å³éµç›’å­ (Right Box) */
      .sorting-box.right.active {
        border-color: #f44336;
        box-shadow: 0 0 20px rgba(244, 67, 54, 0.5);
      }

      /* =================================================================
           å›é¥‹è¨Šæ¯å€åŸŸ (Feedback Message Area)
           ================================================================= */
      #feedbackMessage {
        position: absolute;
        bottom: 50px;
        font-size: 32px;
        font-weight: bold;
        opacity: 0;
        transition: opacity 0.3s;
      }

      #feedbackMessage.show {
        opacity: 1;
      }

      #feedbackMessage.correct {
        color: #4caf50;
      }

      #feedbackMessage.incorrect {
        color: #f44336;
      }

      /* =================================================================
           é€²åº¦æ¢ (Progress Bar)
           ================================================================= */
      #progressBar {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 10px;
        background: #e0e0e0;
      }

      #progressFill {
        height: 100%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        width: 0%;
        transition: width 0.5s;
      }

      /* =================================================================
           çµ±è¨ˆè³‡æ–™å€åŸŸ (Statistics Area)
           ================================================================= */
      .stats-container {
        background: #f8f9fa;
        padding: 30px;
        border-radius: 15px;
        max-width: 600px;
        margin: 20px auto;
      }

      .stats-row {
        display: flex;
        justify-content: space-between;
        padding: 15px;
        margin: 10px 0;
        background: white;
        border-radius: 10px;
        font-size: 18px;
      }

      .stats-label {
        font-weight: bold;
        color: #667eea;
      }

      .stats-value {
        color: #333;
      }

      /* =================================================================
           éŸ¿æ‡‰å¼è¨­è¨ˆ (Responsive Design)
           ================================================================= */
      @media (max-width: 768px) {
        #gameContainer {
          width: 95vw;
          height: 95vh;
        }

        #header {
          font-size: 18px;
          padding: 15px;
        }

        #cardDisplay {
          width: 300px;
          height: 400px;
        }

        .sorting-box {
          width: 100px;
          height: 100px;
        }

        #sortingBoxes {
          gap: 50px;
        }
      }
    </style>
  </head>
  <body>
    <!-- éŠæˆ²ä¸»å®¹å™¨ -->
    <div id="gameContainer">
      <!-- æ¨™é¡Œå€åŸŸ -->
      <div id="header">DCCSèªçŸ¥å½ˆæ€§è¨“ç·´éŠæˆ²</div>

      <!-- ä¸»è¦éŠæˆ²å€åŸŸ -->
      <div id="mainArea">
        <!-- ========================================================
                 é¦–é ç•«é¢ (Landing Screen)
                 ======================================================== -->
        <div id="landingScreen" class="screen active">
          <!-- å­¸è¡“ç ”ç©¶æ€§è³ªèªªæ˜ (ç¬¦åˆ GSB å®‰å…¨è¦ç¯„) -->
          <div
            style="
              background: #e3f2fd;
              padding: 20px;
              border-radius: 15px;
              margin-bottom: 30px;
              max-width: 600px;
              text-align: left;
            "
          >
            <h3 style="color: #1565c0; margin-bottom: 15px">ğŸ“š å­¸è¡“ç ”ç©¶å·¥å…·</h3>
            <p style="margin: 10px 0; line-height: 1.6">
              æœ¬ç³»çµ±ç‚º<strong>ä¸­åŸå¤§å­¸ç‰¹æ®Šæ•™è‚²å­¸ç³»</strong>ç¢©å£«ç­ç ”ç©¶å°ˆæ¡ˆï¼Œ
              å°ˆç‚º<strong>è½éšœå­¸ç”Ÿï¼ˆ7-12æ­²ï¼‰</strong>è¨­è¨ˆçš„èªçŸ¥å½ˆæ€§è¨“ç·´å·¥å…·ã€‚
            </p>
            <p style="margin: 10px 0; line-height: 1.6">
              <strong style="color: #2e7d32">âœ… ä¸æ”¶é›†ä»»ä½•å€‹äººè³‡è¨Š</strong
              ><br />
              <strong style="color: #2e7d32">âœ… æ‰€æœ‰è³‡æ–™åƒ…å­˜æ–¼æ‚¨çš„ç€è¦½å™¨</strong
              ><br />
              <strong style="color: #2e7d32"
                >âœ… é–‹æºé€æ˜ï¼Œå¯æ–¼ GitHub æŸ¥é–±</strong
              >
            </p>
          </div>

          <h2>ğŸ§  æ­¡è¿ä¾†åˆ°èªçŸ¥å½ˆæ€§è¨“ç·´éŠæˆ²</h2>
          <p>é€™å€‹éŠæˆ²æœƒå¹«åŠ©ä½ ç·´ç¿’ã€Œè¦å‰‡è½‰æ›ã€çš„èƒ½åŠ›</p>
          <p>
            è«‹æº–å‚™å¥½éµç›¤ï¼Œä½¿ç”¨<strong>å·¦æ–¹å‘éµ â†</strong> å’Œ
            <strong>å³æ–¹å‘éµ â†’</strong>
          </p>

          <div class="input-group">
            <label for="participantId">è«‹è¼¸å…¥ä½ çš„ç·¨è™Ÿï¼š</label>
            <input type="text" id="participantId" placeholder="ä¾‹å¦‚ï¼šS001" />
          </div>

          <button class="btn" onclick="game.startGame()">é–‹å§‹éŠæˆ²</button>

          <!-- éš±ç§æ¬Šèˆ‡ä½¿ç”¨èªªæ˜ -->
          <div style="margin-top: 30px; font-size: 14px; color: #666">
            <p>
              ğŸ’¾ è³‡æ–™ä¸‹è¼‰èªªæ˜ï¼šéŠæˆ²çµæŸå¾Œå¯ä¸‹è¼‰ CSV
              ç´”æ–‡å­—æª”æ¡ˆä¾›ç ”ç©¶åˆ†æï¼Œä¸å«å€‹äººè­˜åˆ¥è³‡è¨Š
            </p>
            <p>
              ğŸ“– æ›´å¤šè³‡è¨Šè«‹åƒé–± <a href="#" style="color: #667eea">ä½¿ç”¨èªªæ˜</a>
            </p>
          </div>
        </div>

        <!-- ========================================================
                 éšæ®µä¸€èªªæ˜ç•«é¢ (Phase 1 Instruction)
                 ======================================================== -->
        <div id="phase1Instruction" class="screen">
          <div class="instruction-box">
            <h3>ğŸ“˜ éšæ®µä¸€ï¼šå­¸ç¿’è¦å‰‡ï¼ˆèƒŒæ™¯é¡è‰²åˆ†é¡ï¼‰</h3>
            <ul>
              <li>
                ä½ æœƒçœ‹åˆ°ä¸€å¼µå¡ç‰‡ï¼Œå¡ç‰‡æœ‰<span class="highlight">èƒŒæ™¯é¡è‰²</span
                >ï¼ˆè—è‰²æˆ–ç´…è‰²ï¼‰
              </li>
              <li>
                å¡ç‰‡å‰é¢é‚„æœ‰ä¸€å€‹<span class="highlight">é»‘è‰²åœ–æ¡ˆ</span>ï¼ˆçœ¼ç›ğŸ‘ï¸
                æˆ– å˜´å·´ğŸ˜Šï¼‰
              </li>
              <li>
                <strong>è«‹æ³¨æ„ã€ŒèƒŒæ™¯é¡è‰²ã€</strong>ï¼š <br />â€¢ è—è‰²èƒŒæ™¯ â†’
                æŒ‰<strong>å·¦éµ â†</strong> <br />â€¢ ç´…è‰²èƒŒæ™¯ â†’ æŒ‰<strong
                  >å³éµ â†’</strong
                >
              </li>
              <li>
                âš ï¸ é€™å€‹éšæ®µè«‹<strong>å¿½ç•¥</strong>å‰é¢çš„é»‘è‰²åœ–æ¡ˆï¼ˆçœ¼ç›æˆ–å˜´å·´ï¼‰
              </li>
              <li>ç¸½å…±10é¡Œï¼ŒåŠ æ²¹ï¼</li>
            </ul>
          </div>
          <button class="btn" onclick="game.startPhase1()">æˆ‘æº–å‚™å¥½äº†ï¼</button>
        </div>

        <!-- ========================================================
                 éšæ®µäºŒèªªæ˜ç•«é¢ (Phase 2 Instruction)
                 ======================================================== -->
        <div id="phase2Instruction" class="screen">
          <div class="instruction-box">
            <h3>ğŸ“— éšæ®µäºŒï¼šè½‰æ›è¦å‰‡ï¼ˆè‡‰éƒ¨ç‰¹å¾µåˆ†é¡ï¼‰</h3>
            <ul>
              <li><span class="highlight">è¦å‰‡æ”¹è®Šäº†ï¼</span></li>
              <li>
                ç¾åœ¨è«‹<strong>æ³¨æ„ã€Œå‰é¢çš„é»‘è‰²åœ–æ¡ˆã€</strong>ï¼š <br />â€¢ çœ¼ç›ğŸ‘ï¸ â†’
                æŒ‰<strong>å·¦éµ â†</strong> <br />â€¢ å˜´å·´ğŸ˜Š â†’ æŒ‰<strong
                  >å³éµ â†’</strong
                >
              </li>
              <li>âš ï¸ é€™å€‹éšæ®µè«‹<strong>å¿½ç•¥</strong>èƒŒæ™¯é¡è‰²</li>
              <li>è©¦è‘—å¿˜è¨˜ä¸Šä¸€å€‹éšæ®µçš„è¦å‰‡ï¼Œå°ˆæ³¨åœ¨æ–°è¦å‰‡ä¸Šï¼</li>
              <li>ç¸½å…±10é¡Œï¼Œä½ å¯ä»¥çš„ï¼</li>
            </ul>
          </div>
          <button class="btn" onclick="game.startPhase2()">æˆ‘æº–å‚™å¥½äº†ï¼</button>
        </div>

        <!-- ========================================================
                 éšæ®µä¸‰èªªæ˜ç•«é¢ (Phase 3 Instruction)
                 ======================================================== -->
        <div id="phase3Instruction" class="screen">
          <div class="instruction-box">
            <h3>ğŸ“• éšæ®µä¸‰ï¼šæ··åˆè½‰æ›ï¼ˆéš¨æ©Ÿåˆ‡æ›è¦å‰‡ï¼‰</h3>
            <ul>
              <li><span class="highlight">æœ€å¤§æŒ‘æˆ°ä¾†äº†ï¼</span></li>
              <li>æ¯ä¸€é¡Œéƒ½æœƒ<strong>éš¨æ©Ÿ</strong>å‘Šè¨´ä½ è¦ç”¨å“ªå€‹è¦å‰‡</li>
              <li>
                çœ‹åˆ°<strong style="color: blue">è—è‰²æ¨™ç¤º ğŸ¨</strong> â†’
                æŒ‰ã€ŒèƒŒæ™¯é¡è‰²ã€åˆ†é¡
              </li>
              <li>
                çœ‹åˆ°<strong style="color: orange">æ©˜è‰²æ¨™ç¤º ğŸ–¼ï¸</strong> â†’
                æŒ‰ã€Œå‰æ™¯åœ–æ¡ˆã€åˆ†é¡
              </li>
              <li>è¦éš¨æ™‚ä¿æŒæ³¨æ„åŠ›ï¼Œå¿«é€Ÿåˆ‡æ›è¦å‰‡ï¼</li>
              <li>ç¸½å…±16é¡Œï¼Œé€™æ˜¯æœ€å¾Œè¡åˆºï¼</li>
            </ul>
          </div>
          <button class="btn" onclick="game.startPhase3()">æŒ‘æˆ°é–‹å§‹ï¼</button>
        </div>

        <!-- ========================================================
                 éŠæˆ²é€²è¡Œç•«é¢ (Game Playing Screen)
                 ======================================================== -->
        <div id="gameScreen" class="screen">
          <!-- è¦–è¦ºæç¤ºå€åŸŸ -->
          <div id="visualCue">
            <div id="colorCue" class="cue-item">
              <svg class="cue-icon" viewBox="0 0 100 100">
                <rect width="100" height="100" rx="10" fill="#4a90e2" />
              </svg>
              <span>èƒŒæ™¯é¡è‰²</span>
            </div>
            <div id="shapeCue" class="cue-item">
              <svg class="cue-icon" viewBox="0 0 100 100">
                <rect
                  width="100"
                  height="100"
                  rx="10"
                  fill="white"
                  stroke="#333"
                  stroke-width="4"
                />
                <!-- ç°¡åŒ–çš„è‡‰éƒ¨ç‰¹å¾µåœ–ç¤º -->
                <ellipse cx="35" cy="45" rx="8" ry="10" fill="#333" />
                <ellipse cx="65" cy="45" rx="8" ry="10" fill="#333" />
                <path
                  d="M 30 65 Q 50 80 70 65"
                  stroke="#333"
                  stroke-width="4"
                  fill="none"
                  stroke-linecap="round"
                />
              </svg>
              <span>è‡‰éƒ¨ç‰¹å¾µ</span>
            </div>
          </div>

          <!-- å¡ç‰‡é¡¯ç¤ºå€åŸŸ -->
          <div id="cardDisplay">
            <!-- èƒŒæ™¯å±¤ (SVG Container) -->
            <div id="cardBackground"></div>
            <!-- å‰æ™¯å±¤ (SVG Container) -->
            <div id="cardForeground"></div>
          </div>

          <!-- åˆ†é¡ç›’å­ -->
          <div id="sortingBoxes">
            <div class="sorting-box left" id="leftBox">
              <div id="leftBoxIcon"></div>
              <div class="label">æŒ‰ â† å·¦éµ</div>
            </div>
            <div class="sorting-box right" id="rightBox">
              <div id="rightBoxIcon"></div>
              <div class="label">æŒ‰ â†’ å³éµ</div>
            </div>
          </div>

          <!-- å›é¥‹è¨Šæ¯ -->
          <div id="feedbackMessage"></div>

          <!-- é€²åº¦æ¢ -->
          <div id="progressBar">
            <div id="progressFill"></div>
          </div>
        </div>

        <!-- ========================================================
                 çµæœç•«é¢ (Results Screen)
                 ======================================================== -->
        <div id="resultsScreen" class="screen">
          <h2>ğŸ‰ æ­å–œå®Œæˆè¨“ç·´ï¼</h2>
          <div class="stats-container" id="statsContainer">
            <!-- çµ±è¨ˆæ•¸æ“šå°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
          </div>
          <div>
            <button class="btn" onclick="game.exportData()">ğŸ’¾ ä¸‹è¼‰æ•¸æ“š</button>
            <button class="btn btn-secondary" onclick="game.restart()">
              ğŸ”„ é‡æ–°é–‹å§‹
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ========================================================
         JavaScript éŠæˆ²é‚è¼¯
         ======================================================== -->
    <script>
      // ============================================================
      // éŠæˆ²ç‰©ä»¶å®šç¾© (Game Object Definition)
      // ============================================================
      const game = {
        // ========================================================
        // éŠæˆ²ç‹€æ…‹è®Šæ•¸ (Game State Variables)
        // ========================================================
        participantId: "", // å—è©¦è€…ç·¨è™Ÿ
        currentPhase: 0, // ç•¶å‰éšæ®µ (1, 2, 3)
        currentTrial: 0, // ç•¶å‰è©¦é¡Œç·¨è™Ÿ
        totalTrials: 0, // ç•¶å‰éšæ®µç¸½é¡Œæ•¸
        currentCard: null, // ç•¶å‰å¡ç‰‡è³‡æ–™ {background, foreground}
        currentRule: "", // ç•¶å‰åˆ†é¡è¦å‰‡ ('color' or 'shape')
        startTime: 0, // è©¦é¡Œé–‹å§‹æ™‚é–“
        results: [], // æ‰€æœ‰è©¦é¡Œçµæœè¨˜éŒ„

        // ========================================================
        // å¡ç‰‡é…ç½® (Card Configuration)
        // èƒŒæ™¯é¡è‰²: 'blue' (è—è‰²) æˆ– 'red' (ç´…è‰²)
        // å‰æ™¯åœ–æ¡ˆ: 'eyes' (çœ¼ç›ğŸ‘ï¸) æˆ– 'mouth' (å˜´å·´ğŸ˜Š)
        // è¨­è¨ˆä¾æ“šï¼šè½éšœå­¸ç”Ÿå°è‡‰éƒ¨ç‰¹å¾µï¼ˆçœ¼ç›ã€å˜´å‹ï¼‰å…·é«˜åº¦è¦–è¦ºæ•æ„Ÿæ€§
        // ========================================================
        cardConfig: {
          backgrounds: ["blue", "red"],
          foregrounds: ["eyes", "mouth"],
        },

        // ========================================================
        // éšæ®µé…ç½® (Phase Configuration)
        // ========================================================
        phaseConfig: {
          1: { trials: 10, rule: "color" }, // éšæ®µä¸€ï¼šå›ºå®šæŒ‰é¡è‰²
          2: { trials: 10, rule: "shape" }, // éšæ®µäºŒï¼šå›ºå®šæŒ‰åœ–æ¡ˆ
          3: { trials: 16, rule: "mixed" }, // éšæ®µä¸‰ï¼šæ··åˆéš¨æ©Ÿ
        },

        // ========================================================
        // SVG åœ–æª”å®¹å™¨ (SVG Assets Container)
        // è¨­è¨ˆç†å¿µï¼šæ¡ç”¨ã€Œçœ¼ç›vså˜´å·´ã€ç¬¦åˆè½éšœå­¸ç”Ÿè¦–è¦ºå­¸ç¿’ç‰¹æ€§
        // - è½éšœå­¸ç”Ÿé«˜åº¦ä¾è³´è‡‰éƒ¨ç·šç´¢ï¼ˆè®€å”‡ã€è¡¨æƒ…è¾¨è­˜ï¼‰
        // - çœ¼ç›èˆ‡å˜´å·´æ˜¯æ—¥å¸¸æºé€šä¸­æœ€å¸¸æ³¨æ„çš„è¦–è¦ºç„¦é»
        // - å¾®ç¬‘å¼§ç·šè¨­è¨ˆé™ä½å¿ƒç†è² æ“”ï¼Œç¬¦åˆå‹å–„ä»‹é¢åŸå‰‡
        // ========================================================
        svgAssets: {
          // èƒŒæ™¯é¡è‰² (Backgrounds) - 400x500px
          backgrounds: {
            blue: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 500" width="100%" height="100%">
                            <rect width="400" height="500" rx="20" fill="#4A90E2"/>
                          </svg>`,
            red: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 500" width="100%" height="100%">
                           <rect width="400" height="500" rx="20" fill="#E74C3C"/>
                         </svg>`,
          },
          // å‰æ™¯åœ–æ¡ˆ (Foregrounds) - 200x200px é»‘è‰²
          foregrounds: {
            eyes: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" width="200" height="200">
                            <!-- å·¦çœ¼ -->
                            <ellipse cx="65" cy="100" rx="25" ry="35" fill="#000000"/>
                            <!-- å³çœ¼ -->
                            <ellipse cx="135" cy="100" rx="25" ry="35" fill="#000000"/>
                          </svg>`,
            mouth: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" width="200" height="200">
                             <!-- å¾®ç¬‘å¼§ç·š -->
                             <path d="M 50 100 Q 100 150 150 100" 
                                   stroke="#000000" 
                                   stroke-width="15" 
                                   fill="none" 
                                   stroke-linecap="round"/>
                           </svg>`,
          },
          // åˆ†é¡ç›’å­åœ–ç¤º (Sorting Box Icons)
          boxIcons: {
            // éšæ®µä¸€ï¼šé¡è‰²ç›’å­ (80x80px)
            blueBox: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80" width="80" height="80">
                               <rect width="80" height="80" rx="8" fill="#4A90E2"/>
                             </svg>`,
            redBox: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80" width="80" height="80">
                              <rect width="80" height="80" rx="8" fill="#E74C3C"/>
                            </svg>`,
            // éšæ®µäºŒä¸‰ï¼šè‡‰éƒ¨ç‰¹å¾µç›’å­ (80x80px)
            eyesBox: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80" width="80" height="80">
                               <ellipse cx="26" cy="40" rx="10" ry="14" fill="#000000"/>
                               <ellipse cx="54" cy="40" rx="10" ry="14" fill="#000000"/>
                             </svg>`,
            mouthBox: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80" width="80" height="80">
                                <path d="M 20 40 Q 40 60 60 40" 
                                      stroke="#000000" 
                                      stroke-width="8" 
                                      fill="none" 
                                      stroke-linecap="round"/>
                              </svg>`,
          },
        },

        // ========================================================
        // åˆå§‹åŒ–éŠæˆ² (Initialize Game)
        // ========================================================
        init() {
          console.log("ğŸ® éŠæˆ²ç³»çµ±åˆå§‹åŒ–...");

          // ç¶å®šéµç›¤äº‹ä»¶ç›£è½å™¨
          document.addEventListener("keydown", (e) => this.handleKeyPress(e));

          console.log("âœ… éŠæˆ²ç³»çµ±åˆå§‹åŒ–å®Œæˆ");
        },

        // ========================================================
        // é–‹å§‹éŠæˆ² (Start Game)
        // ========================================================
        startGame() {
          // å–å¾—å—è©¦è€…ç·¨è™Ÿ
          this.participantId = document
            .getElementById("participantId")
            .value.trim();

          // æª¢æŸ¥æ˜¯å¦æœ‰è¼¸å…¥ç·¨è™Ÿ
          if (!this.participantId) {
            alert("è«‹è¼¸å…¥å—è©¦è€…ç·¨è™Ÿï¼");
            return;
          }

          console.log(`ğŸš€ éŠæˆ²é–‹å§‹ - å—è©¦è€…: ${this.participantId}`);

          // åˆ‡æ›åˆ°éšæ®µä¸€èªªæ˜ç•«é¢
          this.showScreen("phase1Instruction");
        },

        // ========================================================
        // é–‹å§‹éšæ®µä¸€ (Start Phase 1)
        // ========================================================
        startPhase1() {
          this.currentPhase = 1;
          this.currentTrial = 0;
          this.totalTrials = this.phaseConfig[1].trials;
          this.currentRule = "color"; // å›ºå®šæŒ‰é¡è‰²åˆ†é¡

          console.log("ğŸ“˜ éšæ®µä¸€é–‹å§‹ - æŒ‰èƒŒæ™¯é¡è‰²åˆ†é¡");

          // æ›´æ–°åˆ†é¡ç›’å­åœ–ç¤ºç‚ºé¡è‰²
          this.updateSortingBoxes("color");

          // éš±è—è¦–è¦ºæç¤ºï¼ˆéšæ®µä¸€äºŒä¸éœ€è¦ï¼‰
          document.getElementById("visualCue").style.display = "none";

          // é–‹å§‹ç¬¬ä¸€é¡Œ
          this.nextTrial();
        },

        // ========================================================
        // é–‹å§‹éšæ®µäºŒ (Start Phase 2)
        // ========================================================
        startPhase2() {
          this.currentPhase = 2;
          this.currentTrial = 0;
          this.totalTrials = this.phaseConfig[2].trials;
          this.currentRule = "shape"; // å›ºå®šæŒ‰åœ–æ¡ˆåˆ†é¡

          console.log("ğŸ“— éšæ®µäºŒé–‹å§‹ - æŒ‰å‰æ™¯åœ–æ¡ˆåˆ†é¡");

          // æ›´æ–°åˆ†é¡ç›’å­åœ–ç¤ºç‚ºåœ–æ¡ˆ
          this.updateSortingBoxes("shape");

          // éš±è—è¦–è¦ºæç¤º
          document.getElementById("visualCue").style.display = "none";

          // é–‹å§‹ç¬¬ä¸€é¡Œ
          this.nextTrial();
        },

        // ========================================================
        // é–‹å§‹éšæ®µä¸‰ (Start Phase 3)
        // ========================================================
        startPhase3() {
          this.currentPhase = 3;
          this.currentTrial = 0;
          this.totalTrials = this.phaseConfig[3].trials;

          console.log("ğŸ“• éšæ®µä¸‰é–‹å§‹ - æ··åˆéš¨æ©Ÿè¦å‰‡");

          // éšæ®µä¸‰éœ€è¦é¡¯ç¤ºè¦–è¦ºæç¤º
          document.getElementById("visualCue").style.display = "flex";

          // é–‹å§‹ç¬¬ä¸€é¡Œ
          this.nextTrial();
        },

        // ========================================================
        // ä¸‹ä¸€é¡Œ (Next Trial)
        // ========================================================
        nextTrial() {
          // æª¢æŸ¥æ˜¯å¦å®Œæˆç•¶å‰éšæ®µ
          if (this.currentTrial >= this.totalTrials) {
            this.finishPhase();
            return;
          }

          this.currentTrial++;

          // ç”Ÿæˆéš¨æ©Ÿå¡ç‰‡
          this.currentCard = this.generateRandomCard();

          // éšæ®µä¸‰éœ€è¦éš¨æ©Ÿæ±ºå®šè¦å‰‡
          if (this.currentPhase === 3) {
            this.currentRule = Math.random() < 0.5 ? "color" : "shape";
            this.updateVisualCue(this.currentRule);
            this.updateSortingBoxes(this.currentRule);
          }

          // é¡¯ç¤ºå¡ç‰‡
          this.displayCard(this.currentCard);

          // æ›´æ–°é€²åº¦æ¢
          this.updateProgress();

          // è¨˜éŒ„é–‹å§‹æ™‚é–“
          this.startTime = Date.now();

          // åˆ‡æ›åˆ°éŠæˆ²ç•«é¢
          this.showScreen("gameScreen");
        },

        // ========================================================
        // ç”Ÿæˆéš¨æ©Ÿå¡ç‰‡ (Generate Random Card)
        // ========================================================
        generateRandomCard() {
          const backgrounds = this.cardConfig.backgrounds;
          const foregrounds = this.cardConfig.foregrounds;

          return {
            background:
              backgrounds[Math.floor(Math.random() * backgrounds.length)],
            foreground:
              foregrounds[Math.floor(Math.random() * foregrounds.length)],
          };
        },

        // ========================================================
        // é¡¯ç¤ºå¡ç‰‡ (Display Card)
        // ========================================================
        displayCard(card) {
          // æ¸…é™¤ä¹‹å‰çš„å›é¥‹æ¨£å¼
          const cardDisplay = document.getElementById("cardDisplay");
          cardDisplay.classList.remove("correct", "incorrect");

          // é¡¯ç¤ºèƒŒæ™¯ (ä½¿ç”¨SVG)
          const bgContainer = document.getElementById("cardBackground");
          bgContainer.innerHTML = this.svgAssets.backgrounds[card.background];

          // é¡¯ç¤ºå‰æ™¯ (ä½¿ç”¨SVG)
          const fgContainer = document.getElementById("cardForeground");
          fgContainer.innerHTML = this.svgAssets.foregrounds[card.foreground];

          console.log(
            `ğŸƒ é¡¯ç¤ºå¡ç‰‡ - èƒŒæ™¯: ${card.background}, å‰æ™¯: ${card.foreground}`,
          );
        },

        // ========================================================
        // æ›´æ–°è¦–è¦ºæç¤º (Update Visual Cue)
        // åƒ…åœ¨éšæ®µä¸‰ä½¿ç”¨
        // ========================================================
        updateVisualCue(rule) {
          const colorCue = document.getElementById("colorCue");
          const shapeCue = document.getElementById("shapeCue");

          // ç§»é™¤æ‰€æœ‰activeæ¨£å¼
          colorCue.classList.remove("cue-active");
          shapeCue.classList.remove("cue-active");

          // æ ¹æ“šç•¶å‰è¦å‰‡é«˜äº®å°æ‡‰æç¤º
          if (rule === "color") {
            colorCue.classList.add("cue-active");
          } else {
            shapeCue.classList.add("cue-active");
          }
        },

        // ========================================================
        // æ›´æ–°åˆ†é¡ç›’å­åœ–ç¤º (Update Sorting Box Icons)
        // ========================================================
        updateSortingBoxes(rule) {
          const leftIcon = document.getElementById("leftBoxIcon");
          const rightIcon = document.getElementById("rightBoxIcon");

          if (rule === "color") {
            // é¡è‰²è¦å‰‡ï¼šå·¦=è—è‰²ï¼Œå³=ç´…è‰²
            leftIcon.innerHTML = this.svgAssets.boxIcons.blueBox;
            rightIcon.innerHTML = this.svgAssets.boxIcons.redBox;
          } else {
            // è‡‰éƒ¨ç‰¹å¾µè¦å‰‡ï¼šå·¦=çœ¼ç›ï¼Œå³=å˜´å·´
            leftIcon.innerHTML = this.svgAssets.boxIcons.eyesBox;
            rightIcon.innerHTML = this.svgAssets.boxIcons.mouthBox;
          }
        },

        // ========================================================
        // æ›´æ–°é€²åº¦æ¢ (Update Progress Bar)
        // ========================================================
        updateProgress() {
          const progress = (this.currentTrial / this.totalTrials) * 100;
          document.getElementById("progressFill").style.width = `${progress}%`;
        },

        // ========================================================
        // è™•ç†éµç›¤æŒ‰éµ (Handle Key Press)
        // ========================================================
        handleKeyPress(e) {
          // åªåœ¨éŠæˆ²é€²è¡Œä¸­æ‰è™•ç†æŒ‰éµ
          const gameScreen = document.getElementById("gameScreen");
          if (!gameScreen.classList.contains("active")) return;

          // æŒ‰å·¦éµ (ArrowLeft) æˆ– å³éµ (ArrowRight)
          if (e.key === "ArrowLeft" || e.key === "ArrowRight") {
            e.preventDefault(); // é˜²æ­¢é é¢æ»¾å‹•
            this.checkAnswer(e.key);
          }
        },

        // ========================================================
        // æª¢æŸ¥ç­”æ¡ˆ (Check Answer)
        // ========================================================
        checkAnswer(keyPressed) {
          // è¨ˆç®—åæ‡‰æ™‚é–“
          const reactionTime = Date.now() - this.startTime;

          // åˆ¤æ–·æ­£ç¢ºç­”æ¡ˆ
          let correctKey;
          if (this.currentRule === "color") {
            // æŒ‰é¡è‰²ï¼šè—è‰²â†’å·¦éµï¼Œç´…è‰²â†’å³éµ
            correctKey =
              this.currentCard.background === "blue"
                ? "ArrowLeft"
                : "ArrowRight";
          } else {
            // æŒ‰è‡‰éƒ¨ç‰¹å¾µï¼šçœ¼ç›â†’å·¦éµï¼Œå˜´å·´â†’å³éµ
            correctKey =
              this.currentCard.foreground === "eyes"
                ? "ArrowLeft"
                : "ArrowRight";
          }

          const isCorrect = keyPressed === correctKey;

          // è¨˜éŒ„çµæœ
          this.recordResult({
            participantId: this.participantId,
            phase: this.currentPhase,
            trial: this.currentTrial,
            rule: this.currentRule,
            cardBackground: this.currentCard.background,
            cardForeground: this.currentCard.foreground,
            keyPressed: keyPressed,
            correctKey: correctKey,
            isCorrect: isCorrect,
            reactionTime: reactionTime,
            timestamp: new Date().toISOString(),
          });

          // é¡¯ç¤ºå›é¥‹
          this.showFeedback(isCorrect);

          // 1ç§’å¾Œé€²å…¥ä¸‹ä¸€é¡Œ
          setTimeout(() => {
            this.nextTrial();
          }, 1000);
        },

        // ========================================================
        // è¨˜éŒ„çµæœ (Record Result)
        // ========================================================
        recordResult(data) {
          this.results.push(data);
          console.log(
            `ğŸ“Š è¨˜éŒ„çµæœ - éšæ®µ${data.phase} ç¬¬${data.trial}é¡Œ: ${data.isCorrect ? "âœ…æ­£ç¢º" : "âŒéŒ¯èª¤"} (${data.reactionTime}ms)`,
          );
        },

        // ========================================================
        // é¡¯ç¤ºå›é¥‹ (Show Feedback)
        // ========================================================
        showFeedback(isCorrect) {
          const cardDisplay = document.getElementById("cardDisplay");
          const feedbackMsg = document.getElementById("feedbackMessage");

          if (isCorrect) {
            cardDisplay.classList.add("correct");
            feedbackMsg.textContent = "âœ… ç­”å°äº†ï¼";
            feedbackMsg.className = "show correct";

            // æ’­æ”¾æ­£ç¢ºéŸ³æ•ˆï¼ˆå¯é¸ï¼‰
            // this.playSound('correct');
          } else {
            cardDisplay.classList.add("incorrect");
            feedbackMsg.textContent = "âŒ ç­”éŒ¯äº†ï¼";
            feedbackMsg.className = "show incorrect";

            // æ’­æ”¾éŒ¯èª¤éŸ³æ•ˆï¼ˆå¯é¸ï¼‰
            // this.playSound('incorrect');
          }

          // 0.5ç§’å¾Œéš±è—å›é¥‹
          setTimeout(() => {
            feedbackMsg.classList.remove("show");
          }, 500);
        },

        // ========================================================
        // å®Œæˆéšæ®µ (Finish Phase)
        // ========================================================
        finishPhase() {
          console.log(`ğŸ éšæ®µ${this.currentPhase}å®Œæˆ`);

          if (this.currentPhase === 1) {
            // é€²å…¥éšæ®µäºŒ
            this.showScreen("phase2Instruction");
          } else if (this.currentPhase === 2) {
            // é€²å…¥éšæ®µä¸‰
            this.showScreen("phase3Instruction");
          } else if (this.currentPhase === 3) {
            // å…¨éƒ¨å®Œæˆï¼Œé¡¯ç¤ºçµæœ
            this.showResults();
          }
        },

        // ========================================================
        // é¡¯ç¤ºçµæœ (Show Results)
        // ========================================================
        showResults() {
          console.log("ğŸ‰ å…¨éƒ¨éšæ®µå®Œæˆï¼");

          // è¨ˆç®—çµ±è¨ˆæ•¸æ“š
          const stats = this.calculateStats();

          // ç”Ÿæˆçµ±è¨ˆHTML
          const statsContainer = document.getElementById("statsContainer");
          statsContainer.innerHTML = `
                    <div class="stats-row">
                        <span class="stats-label">ç¸½é¡Œæ•¸ï¼š</span>
                        <span class="stats-value">${stats.totalTrials} é¡Œ</span>
                    </div>
                    <div class="stats-row">
                        <span class="stats-label">ç¸½æ­£ç¢ºæ•¸ï¼š</span>
                        <span class="stats-value">${stats.totalCorrect} é¡Œ</span>
                    </div>
                    <div class="stats-row">
                        <span class="stats-label">ç¸½æ­£ç¢ºç‡ï¼š</span>
                        <span class="stats-value">${stats.totalAccuracy.toFixed(1)}%</span>
                    </div>
                    <hr>
                    <div class="stats-row">
                        <span class="stats-label">éšæ®µä¸€æ­£ç¢ºç‡ï¼š</span>
                        <span class="stats-value">${stats.phase1Accuracy.toFixed(1)}%</span>
                    </div>
                    <div class="stats-row">
                        <span class="stats-label">éšæ®µäºŒæ­£ç¢ºç‡ï¼š</span>
                        <span class="stats-value">${stats.phase2Accuracy.toFixed(1)}%</span>
                    </div>
                    <div class="stats-row">
                        <span class="stats-label">éšæ®µä¸‰æ­£ç¢ºç‡ï¼š</span>
                        <span class="stats-value">${stats.phase3Accuracy.toFixed(1)}%</span>
                    </div>
                    <hr>
                    <div class="stats-row">
                        <span class="stats-label">å¹³å‡åæ‡‰æ™‚é–“ï¼š</span>
                        <span class="stats-value">${stats.avgRT.toFixed(0)} ms</span>
                    </div>
                `;

          // åˆ‡æ›åˆ°çµæœç•«é¢
          this.showScreen("resultsScreen");
        },

        // ========================================================
        // è¨ˆç®—çµ±è¨ˆæ•¸æ“š (Calculate Statistics)
        // ========================================================
        calculateStats() {
          const totalTrials = this.results.length;
          const totalCorrect = this.results.filter((r) => r.isCorrect).length;
          const totalAccuracy = (totalCorrect / totalTrials) * 100;

          // åˆ†éšæ®µè¨ˆç®—
          const phase1Results = this.results.filter((r) => r.phase === 1);
          const phase2Results = this.results.filter((r) => r.phase === 2);
          const phase3Results = this.results.filter((r) => r.phase === 3);

          const phase1Accuracy =
            (phase1Results.filter((r) => r.isCorrect).length /
              phase1Results.length) *
            100;
          const phase2Accuracy =
            (phase2Results.filter((r) => r.isCorrect).length /
              phase2Results.length) *
            100;
          const phase3Accuracy =
            (phase3Results.filter((r) => r.isCorrect).length /
              phase3Results.length) *
            100;

          // å¹³å‡åæ‡‰æ™‚é–“
          const totalRT = this.results.reduce(
            (sum, r) => sum + r.reactionTime,
            0,
          );
          const avgRT = totalRT / totalTrials;

          return {
            totalTrials,
            totalCorrect,
            totalAccuracy,
            phase1Accuracy,
            phase2Accuracy,
            phase3Accuracy,
            avgRT,
          };
        },

        // ========================================================
        // åŒ¯å‡ºæ•¸æ“š (Export Data)
        //
        // ã€æ•™å­¸è¨»è§£ã€‘çµ¦é›¶åŸºç¤åˆå­¸è€…ï¼š
        // é€™å€‹å‡½æ•¸è² è²¬å°‡éŠæˆ²è¨˜éŒ„çš„è³‡æ–™åŒ¯å‡ºæˆ CSV æª”æ¡ˆ
        // CSV = Comma-Separated Valuesï¼ˆé€—è™Ÿåˆ†éš”å€¼ï¼‰
        // æ˜¯ä¸€ç¨®ç°¡å–®çš„ç´”æ–‡å­—æ ¼å¼ï¼ŒExcel å’Œ Google Sheets éƒ½å¯ä»¥é–‹å•Ÿ
        //
        // âš ï¸ å®‰å…¨æ€§é‡é»ï¼ˆç¬¦åˆ Google Safe Browsing è¦ç¯„ï¼‰ï¼š
        // 1. åªåŒ¯å‡ºç´”æ–‡å­—è³‡æ–™ï¼ˆ.csvï¼‰ï¼Œä¸æ˜¯å¯åŸ·è¡Œæª”ï¼ˆ.exeï¼‰
        // 2. å¿…é ˆç”±ä½¿ç”¨è€…ä¸»å‹•é»æ“ŠæŒ‰éˆ•è§¸ç™¼ï¼Œä¸æœƒè‡ªå‹•ä¸‹è¼‰
        // 3. è³‡æ–™ä¸åŒ…å«ä»»ä½•å€‹äººè­˜åˆ¥è³‡è¨Šï¼ˆå§“åã€èº«åˆ†è­‰å­—è™Ÿç­‰ï¼‰
        // 4. æ‰€æœ‰è³‡æ–™è™•ç†éƒ½åœ¨ç€è¦½å™¨æœ¬åœ°å®Œæˆï¼Œä¸æœƒä¸Šå‚³åˆ°ä¼ºæœå™¨
        // ========================================================
        exportData() {
          // ====================================================
          // æ­¥é©Ÿ1ï¼šå®šç¾©CSVæª”æ¡ˆçš„æ¬„ä½æ¨™é¡Œ
          // ====================================================
          // ã€æ•™å­¸ã€‘é€™äº›æ¨™é¡Œæœƒæˆç‚ºExcelçš„ç¬¬ä¸€è¡Œ
          const headers = [
            "ParticipantID", // å—è©¦è€…ç·¨è™Ÿï¼ˆä¾‹å¦‚ï¼šS001ï¼‰
            "Phase", // éšæ®µç·¨è™Ÿï¼ˆ1, 2, æˆ– 3ï¼‰
            "Trial", // è©¦é¡Œç·¨è™Ÿï¼ˆç¬¬1é¡Œã€ç¬¬2é¡Œ...ï¼‰
            "Rule", // ç•¶å‰è¦å‰‡ï¼ˆ'color' æˆ– 'shape'ï¼‰
            "CardBackground", // å¡ç‰‡èƒŒæ™¯é¡è‰²ï¼ˆ'blue' æˆ– 'red'ï¼‰
            "CardForeground", // å¡ç‰‡å‰æ™¯åœ–æ¡ˆï¼ˆ'eyes' æˆ– 'mouth'ï¼‰
            "KeyPressed", // ä½¿ç”¨è€…æŒ‰çš„éµï¼ˆ'ArrowLeft' æˆ– 'ArrowRight'ï¼‰
            "CorrectKey", // æ­£ç¢ºç­”æ¡ˆçš„éµ
            "IsCorrect", // æ˜¯å¦ç­”å°ï¼ˆ'yes' æˆ– 'no'ï¼‰
            "ReactionTime_ms", // åæ‡‰æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰
            "Timestamp", // æ™‚é–“æˆ³è¨˜ï¼ˆè¨˜éŒ„ç­”é¡Œæ™‚é–“ï¼‰
          ];

          // ====================================================
          // æ­¥é©Ÿ2ï¼šå»ºç«‹CSVæª”æ¡ˆå…§å®¹
          // ====================================================
          // ã€æ•™å­¸ã€‘\uFEFF æ˜¯ UTF-8 BOM (Byte Order Mark)
          // åŠ ä¸Šé€™å€‹ï¼ŒExcel æ‰èƒ½æ­£ç¢ºé¡¯ç¤ºä¸­æ–‡å­—
          let csvContent = "\uFEFF";

          // ã€æ•™å­¸ã€‘å°‡æ¨™é¡Œç”¨é€—è™Ÿé€£æ¥èµ·ä¾†ï¼Œä¸¦åŠ ä¸Šæ›è¡Œç¬¦è™Ÿ
          // ä¾‹å¦‚ï¼š'ParticipantID,Phase,Trial,...'
          csvContent += headers.join(",") + "\n";

          // ====================================================
          // æ­¥é©Ÿ3ï¼šå°‡æ¯ä¸€ç­†è©¦é¡Œè¨˜éŒ„è½‰æ›æˆCSVæ ¼å¼
          // ====================================================
          // ã€æ•™å­¸ã€‘forEach æ˜¯é™£åˆ—çš„è¿´åœˆæ–¹æ³•
          // å®ƒæœƒå° this.results é™£åˆ—ä¸­çš„æ¯ä¸€å€‹ result åŸ·è¡Œä¸€æ¬¡å‡½æ•¸
          this.results.forEach((result) => {
            // ã€æ•™å­¸ã€‘å°‡æ¯å€‹æ¬„ä½çš„å€¼çµ„æˆä¸€å€‹é™£åˆ—
            const row = [
              result.participantId,
              result.phase,
              result.trial,
              result.rule,
              result.cardBackground,
              result.cardForeground,
              result.keyPressed,
              result.correctKey,
              result.isCorrect ? "yes" : "no", // å°‡å¸ƒæ—å€¼è½‰æˆæ–‡å­—
              result.reactionTime,
              result.timestamp,
            ];

            // ã€æ•™å­¸ã€‘å°‡é€™ä¸€è¡Œçš„è³‡æ–™ç”¨é€—è™Ÿé€£æ¥ï¼Œä¸¦åŠ ä¸Šæ›è¡Œ
            csvContent += row.join(",") + "\n";
          });

          // ====================================================
          // æ­¥é©Ÿ4ï¼šå»ºç«‹å¯ä¸‹è¼‰çš„æª”æ¡ˆ
          // ====================================================
          // ã€æ•™å­¸ã€‘Blob = Binary Large Objectï¼ˆäºŒé€²ä½å¤§å‹ç‰©ä»¶ï¼‰
          // å¯ä»¥æŠŠå®ƒæƒ³åƒæˆä¸€å€‹ã€Œè™›æ“¬æª”æ¡ˆã€ï¼Œå­˜åœ¨ç€è¦½å™¨è¨˜æ†¶é«”ä¸­
          // type: 'text/csv;charset=utf-8' å‘Šè¨´ç€è¦½å™¨é€™æ˜¯ CSV ç´”æ–‡å­—æª”
          const blob = new Blob([csvContent], {
            type: "text/csv;charset=utf-8;",
          });

          // ã€æ•™å­¸ã€‘å‹•æ…‹å»ºç«‹ä¸€å€‹ <a> æ¨™ç±¤ï¼ˆè¶…é€£çµï¼‰
          const link = document.createElement("a");

          // ã€æ•™å­¸ã€‘createObjectURL æœƒç‚ºé€™å€‹è™›æ“¬æª”æ¡ˆå‰µé€ ä¸€å€‹è‡¨æ™‚ç¶²å€
          // ä¾‹å¦‚ï¼šblob:https://example.com/550e8400-e29b-41d4-a716-446655440000
          const url = URL.createObjectURL(blob);

          // ã€æ•™å­¸ã€‘è¨­å®šä¸‹è¼‰çš„æª”æ¡ˆåç¨±
          // æ ¼å¼ï¼šDCCSè¨“ç·´æ•¸æ“š_å—è©¦è€…ç·¨è™Ÿ_æ—¥æœŸ.csv
          // ä¾‹å¦‚ï¼šDCCSè¨“ç·´æ•¸æ“š_S001_2026-01-19.csv
          const filename = `DCCSè¨“ç·´æ•¸æ“š_${this.participantId}_${new Date().toISOString().slice(0, 10)}.csv`;

          // ====================================================
          // æ­¥é©Ÿ5ï¼šè¨­å®šä¸‹è¼‰é€£çµä¸¦è§¸ç™¼ä¸‹è¼‰
          // ====================================================
          link.setAttribute("href", url); // è¨­å®šé€£çµæŒ‡å‘è™›æ“¬æª”æ¡ˆ
          link.setAttribute("download", filename); // è¨­å®šä¸‹è¼‰æª”å
          link.style.display = "none"; // éš±è—é€£çµï¼ˆä½¿ç”¨è€…çœ‹ä¸åˆ°ï¼‰

          // ã€æ•™å­¸ã€‘å°‡é€£çµæš«æ™‚åŠ å…¥ç¶²é ä¸­
          document.body.appendChild(link);

          // ã€æ•™å­¸ã€‘è‡ªå‹•é»æ“Šé€™å€‹é€£çµï¼Œè§¸ç™¼ç€è¦½å™¨çš„ä¸‹è¼‰åŠŸèƒ½
          // âš ï¸ æ³¨æ„ï¼šé€™æ˜¯ã€Œä½¿ç”¨è€…é»æ“ŠåŒ¯å‡ºæŒ‰éˆ•å¾Œã€æ‰åŸ·è¡Œçš„
          // ä¸æ˜¯è‡ªå‹•ä¸‹è¼‰ï¼Œç¬¦åˆ Google Safe Browsing å®‰å…¨è¦ç¯„
          link.click();

          // ====================================================
          // æ­¥é©Ÿ6ï¼šæ¸…ç†è³‡æº
          // ====================================================
          // ã€æ•™å­¸ã€‘ä¸‹è¼‰å®Œæˆå¾Œè¦æ¸…ç†è‡¨æ™‚å»ºç«‹çš„å…ƒç´ 
          document.body.removeChild(link);

          // ã€æ•™å­¸ã€‘åœ¨æ§åˆ¶å°è¨˜éŒ„åŒ¯å‡ºæˆåŠŸè¨Šæ¯
          console.log(`ğŸ’¾ æ•¸æ“šå·²åŒ¯å‡º: ${filename}`);
          console.log(`ğŸ“Š å…±åŒ¯å‡º ${this.results.length} ç­†è©¦é¡Œè¨˜éŒ„`);
        },

        // ========================================================
        // é‡æ–°é–‹å§‹ (Restart)
        // ========================================================
        restart() {
          // é‡ç½®æ‰€æœ‰ç‹€æ…‹
          this.participantId = "";
          this.currentPhase = 0;
          this.currentTrial = 0;
          this.results = [];

          // æ¸…ç©ºç·¨è™Ÿè¼¸å…¥æ¡†
          document.getElementById("participantId").value = "";

          // è¿”å›é¦–é 
          this.showScreen("landingScreen");

          console.log("ğŸ”„ éŠæˆ²é‡ç½®");
        },

        // ========================================================
        // åˆ‡æ›ç•«é¢ (Show Screen)
        // ========================================================
        showScreen(screenId) {
          // éš±è—æ‰€æœ‰ç•«é¢
          const screens = document.querySelectorAll(".screen");
          screens.forEach((screen) => screen.classList.remove("active"));

          // é¡¯ç¤ºæŒ‡å®šç•«é¢
          const targetScreen = document.getElementById(screenId);
          targetScreen.classList.add("active");
        },
      };

      // ============================================================
      // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–éŠæˆ²
      // ============================================================
      window.addEventListener("DOMContentLoaded", () => {
        game.init();
      });
    </script>
  </body>
</html>
